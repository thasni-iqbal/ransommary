/**
 * jPList - jQuery Data Grid Controls
 * jPList Store Locator Bundle 1.0.0.74 - http://jplist.com
 * Copyright 2016 Miriam Zusin
 */
(function(){var c=function(a,b){for(var g,f=[],d=0;d<b.length;d++)g=b[d],g=new jQuery.fn.jplist.controls.GoogleMapsControl.StoreModel(g.$item),f.push(g);a.params.mapView.setStores(f)},d=function(a){a.observer.on(a.observer.events.collectionReadyEvent,function(b,g){a.params.dataitems=g.dataitems;c(a,a.params.dataitems)});a.observer.on(a.observer.events.statusesAppliedToList,function(b,g){a.params.dataview=g.dataview;c(a,a.params.dataview)});a.observer.on("jplist.map.store.clicked",function(b,g,f){a.params.mapView.showStore(g,
f,a.params.userSettings.storeZoom)})},e=function(a){a.params={userSettings:{},mapView:null,storesView:null,dataitems:[],dataview:[]};var b=a.params,g;g=a.$control.attr("data-styles")||"";var f=null;g&&(f=jQuery.fn.jplist.settings[g]);g={latitude:Number(a.$control.attr("data-latitude"))||0,longitude:Number(a.$control.attr("data-longitude"))||0,initialZoom:Number(a.$control.attr("data-initial-zoom"))||2,mapTypeId:a.$control.attr("data-map-type")||"ROADMAP",storeZoom:Number(a.$control.attr("data-store-zoom"))||
17,geolocation:"true"===a.$control.attr("data-geolocation"),directionsType:a.$control.attr("data-directions-type")||"DRIVING",openInfoWindowOnStoreClick:a.$control.attr("data-open-popup-store-click")||!1,customMarkerIcon:a.$control.attr("data-marker-icon"),markerText:a.$control.attr("data-marker-text")||"Click to Zoom",mapStyles:f};b.userSettings=g;a.params.mapView=new jQuery.fn.jplist.controls.GoogleMapsControl.MapView(a.params.userSettings,a.observer,a.$control);a.params.storesView=new jQuery.fn.jplist.controls.GoogleMapsControl.StoresView(a.params.userSettings,
a.observer,a.$root.find(a.options.itemsBox),a.options.itemPath);d(a);return jQuery.extend(this,a)};e.prototype.getStatus=function(a){var b=null;a=a?new jQuery.fn.jplist.controls.GoogleMapsDTO(this.params.dataitems):new jQuery.fn.jplist.controls.GoogleMapsDTO(this.params.dataview);return b=new jQuery.fn.jplist.StatusDTO(this.name,this.action,this.type,a,this.inStorage,this.inAnimation,this.isAnimateToTop,this.inDeepLinking)};e.prototype.setStatus=function(a,b){};jQuery.fn.jplist.controls.GoogleMapsControl=
function(a){return new e(a)};jQuery.fn.jplist.controlTypes["google-maps-control"]={className:"GoogleMapsControl",options:{}}})();(function(){var c=function(a,b){for(var d,c=0;c<a.stores.length;c++)d=a.stores[c],d.remove();a.stores=[];a.stores=b;if(a.mapCanvas)for(d=0;d<b.length;d++){var c=b[d],e=null;c.customMarkerIcon?e=c.customMarkerIcon:a.userSettings.customMarkerIcon&&(e=a.userSettings.customMarkerIcon);c.marker=new jQuery.fn.jplist.controls.GoogleMapsControl.MarkerModel(a.observer,c.longitude,c.latitude,a.mapCanvas,a.userSettings.markerText,c.html,e)}a.directionsDisplay&&a.directionsDisplay.set("directions",null)},d=function(a,
b,d,c){b=new google.maps.LatLng(b,d);a.mapCanvas.setCenter(b);a.mapCanvas.setZoom(c)},e=function(a){for(var b=0;b<a.stores.length;b++)a.stores[b].closeStorePopup()},a=function(a){a.userSettings.geolocation&&navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(b){d(a,b.coords.latitude,b.coords.longitude,a.userSettings.storeZoom)})},b=function(b){window.google&&window.google.maps&&window.google.maps.event.addDomListener(window,"load",function(){var d;d=new google.maps.LatLng(b.userSettings.latitude,
b.userSettings.longitude);d={mapTypeId:google.maps.MapTypeId[b.userSettings.mapTypeId],center:d,zoom:b.userSettings.initialZoom};b.userSettings.mapStyles&&(d.styles=b.userSettings.mapStyles);b.mapCanvas=new window.google.maps.Map(b.$map.get(0),d);c(b,b.stores);a(b)});b.observer.on("jplist.map.marker.clicked",function(a,d,c){e(b)});b.observer.$root.on("jplist.directions.changed",function(a,d,c){b.directionsService||(b.directionsService=new window.google.maps.DirectionsService);b.directionsDisplay||
(b.directionsDisplay=new window.google.maps.DirectionsRenderer,b.directionsDisplay.setMap(b.mapCanvas));b.directionsService.route({origin:d,destination:c,travelMode:window.google.maps.DirectionsTravelMode[b.userSettings.directionsType]},function(a,f){f===window.google.maps.DirectionsStatus.OK?b.directionsDisplay.setDirections(a):b.observer.$root.trigger("jplist.directions.error",[f,d,c])})})};jQuery.fn.jplist.controls.GoogleMapsControl.MapView=function(a,d,c){this.userSettings=a;this.$map=c;this.observer=
d;this.mapCanvas=null;this.stores=[];b(this)};jQuery.fn.jplist.controls.GoogleMapsControl.MapView.prototype.showLocation=function(b,a,c){d(this,b,a,c)};jQuery.fn.jplist.controls.GoogleMapsControl.MapView.prototype.showStore=function(b,a,c){var h;e(this);for(var l=0;l<this.stores.length;l++)if(h=this.stores[l],h.latitude===b&&h.longitude===a){d(this,b,a,c);this.userSettings.openInfoWindowOnStoreClick&&h.openStorePopup();break}};jQuery.fn.jplist.controls.GoogleMapsControl.MapView.prototype.setStores=
function(b){c(this,b)}})();(function(){var c=function(d){d.$storesPanel.on("click",d.storePath,function(){var c=jQuery(this);d.$storesPanel.find(d.storePath).removeClass("jplist-active-store");c.addClass("jplist-active-store");d.observer.trigger("jplist.map.store.clicked",[Number(c.attr("data-latitude")),Number(c.attr("data-longitude"))])})};jQuery.fn.jplist.controls.GoogleMapsControl.StoresView=function(d,e,a,b){this.userSettings=d;this.observer=e;this.$storesPanel=a;this.storePath=b;c(this)}})();(function(){var c=function(c,e){var a;a=c.$store.find('[data-type="'+e+'"]');return 0<a.length?a.text():null};jQuery.fn.jplist.controls.GoogleMapsControl.StoreModel=function(d){this.marker=null;this.$store=d;this.latitude=Number(this.$store.attr("data-latitude"))||0;this.longitude=Number(this.$store.attr("data-longitude"))||0;this.customMarkerIcon=this.$store.attr("data-marker-icon");this.html=d.html();this.title=c(this,"title");this.address=c(this,"address");this.city=c(this,"city");this.state=c(this,
"state");this.zipcode=c(this,"zipcode");this.country=c(this,"country")};jQuery.fn.jplist.controls.GoogleMapsControl.StoreModel.prototype.openStorePopup=function(){this.marker&&this.marker.openPopup()};jQuery.fn.jplist.controls.GoogleMapsControl.StoreModel.prototype.closeStorePopup=function(){this.marker&&this.marker.closePopup()};jQuery.fn.jplist.controls.GoogleMapsControl.StoreModel.prototype.remove=function(){this.marker&&this.marker.remove()}})();(function(){var c=function(c){window.google.maps.event.addListener(c.gmarker,"click",function(e){c.observer.trigger("jplist.map.marker.clicked");c.gmarker.infowindow.open(c.map,c.gmarker)})};jQuery.fn.jplist.controls.GoogleMapsControl.MarkerModel=function(d,e,a,b,g,f,k){this.position=new window.google.maps.LatLng(a,e);this.map=b;this.observer=d;this.title=g;this.icon=k;this.gmarker=new window.google.maps.Marker({position:this.position,map:this.map,title:this.title,icon:this.icon});this.gmarker.infowindow=
new window.google.maps.InfoWindow;this.gmarker.infowindow.setContent('<div class="jplist-marker-popup">'+f+"</div>");c(this)};jQuery.fn.jplist.controls.GoogleMapsControl.MarkerModel.prototype.openPopup=function(){window.google.maps.event.trigger(this.gmarker,"click")};jQuery.fn.jplist.controls.GoogleMapsControl.MarkerModel.prototype.closePopup=function(){this.gmarker&&this.gmarker.infowindow&&this.gmarker.infowindow.close()};jQuery.fn.jplist.controls.GoogleMapsControl.MarkerModel.prototype.remove=
function(){this.gmarker.setMap(null)}})();(function(){jQuery.fn.jplist.controls.GoogleMapsDTO=function(c){return{items:c}}})();(function(){jQuery.fn.jplist.FiltersService=jQuery.fn.jplist.FiltersService||{};jQuery.fn.jplist.FiltersService.autocompleteFilter=function(c,d,e,a,b){var g=[],f,k;if(jQuery.isNumeric(c)&&jQuery.isNumeric(d)&&window.google&&0<b){c=new window.google.maps.LatLng(c,d);for(var h=0;h<a.length;h++)d=a[h],f=new jQuery.fn.jplist.controls.GoogleMapsControl.StoreModel(d.jqElement),k=f.country?jQuery.trim(f.country.toLowerCase())==jQuery.trim(e.toLowerCase()):!1,f=new window.google.maps.LatLng(f.latitude,f.longitude),
f=window.google.maps.geometry.spherical.computeDistanceBetween(c,f),(f<=b||k)&&g.push(d);return g}return a}})();(function(){jQuery.fn.jplist.DTOMapperService=jQuery.fn.jplist.DTOMapperService||{};jQuery.fn.jplist.DTOMapperService.filters=jQuery.fn.jplist.DTOMapperService.filters||{};jQuery.fn.jplist.DTOMapperService.filters.AutocompleteFilter=function(c,d){return jQuery.fn.jplist.FiltersService.autocompleteFilter(c.data.latitude,c.data.longitude,c.data.name,d,c.data.radius)}})();(function(){var c=function(b){var a=e(b,!1);b.history.addStatus(a);b.observer.trigger(b.observer.events.knownStatusesChanged,[[a]])},d=function(b){b.params.handler&&window.google.maps.event.removeListener(b.params.handler);b.params.handler=window.google.maps.event.addListener(b.params.autocomplete,"place_changed",function(){b.params.place=b.params.autocomplete.getPlace();c(b)});b.$control.find('[data-type="clear"]').off("click").on("click",function(){b.params.$input.val("");b.params.place=null;c(b)});
b.params.$input.off("keyup").on("keyup",function(a){""===jQuery.trim(jQuery(this).val())&&(b.params.place=null,c(b))});b.params.$select.off("change").on("change",function(){c(b)})},e=function(a,c){var d=null;c||!a.params.place?d=new jQuery.fn.jplist.controls.AutocompleteDTO(0,0,"",0):(d=0<a.params.$select.length?Number($.trim(a.params.$select.val()))||0:a.params.defaultRadius,d="km"===a.params.radiusUnits?1E3*d:1609.34*d,d=new jQuery.fn.jplist.controls.AutocompleteDTO(a.params.place.geometry.location.lat(),
a.params.place.geometry.location.lng(),a.params.place.name,d));return d=new jQuery.fn.jplist.StatusDTO(a.name,a.action,a.type,d,a.inStorage,a.inAnimation,a.isAnimateToTop,a.inDeepLinking)},a=function(a){a.params={autocomplete:null,place:null,$input:a.$control.find('input[type="text"]'),$select:a.$control.find("select"),defaultRadius:Number(a.$control.attr("data-radius"))||0,radiusUnits:$.trim(a.$control.attr("data-units"))||"miles"};window.google&&window.google.maps&&window.google.maps.event.addDomListener(window,
"load",function(){a.params.autocomplete=new window.google.maps.places.Autocomplete(a.params.$input.get(0));d(a)});return jQuery.extend(this,a)};a.prototype.getStatus=function(a){return e(this,a)};a.prototype.setStatus=function(a,c){a&&a.data&&!a.data.name&&(this.params.$input.val(""),this.params.place=null)};jQuery.fn.jplist.controls.GoogleAutocompleteControl=function(b){return new a(b)};jQuery.fn.jplist.controlTypes["google-autocomplete-control"]={className:"GoogleAutocompleteControl",options:{}}})();(function(){jQuery.fn.jplist.controls.AutocompleteDTO=function(c,d,e,a){return{latitude:c,longitude:d,name:e,radius:a,filterType:"AutocompleteFilter"}}})();(function(){jQuery.fn.jplist.controls.GoogleMapDirectionsDTO=function(c){return{place:c}}})();(function(){var c=function(a){a.params.enabled||(a.params.enabled=!0,a.params.autocomplete=new window.google.maps.places.Autocomplete(a.params.$input.get(0)),window.google.maps.event.addListener(a.params.autocomplete,"place_changed",function(){var b,c;(b=a.params.autocomplete.getPlace())&&b.geometry&&(c=new window.google.maps.LatLng(a.params.startLatitude,a.params.startLongitude),b=new window.google.maps.LatLng(b.geometry.location.lat(),b.geometry.location.lng()),a.observer.$root.trigger("jplist.directions.changed",
[c,b]))}))},d=function(a){a.params.$input.on("click",function(a){a.preventDefault();return!1});a.params.$label.on("click",function(b){b.preventDefault();b=a.$control.parents('[data-type="store"]');0<b.length&&(a.params.startLatitude=Number(b.attr("data-latitude"))||0,a.params.startLongitude=Number(b.attr("data-longitude"))||0);c(a);a.params.$input.toggle(0);return!1});a.observer.$root.on("jplist.directions.error",function(b,c,d,e){if(a.params.startLatitude===d.lat()&&a.params.startLongitude===d.lng()){var h=
$('<div class="jplist-direction-err">No results found</div>');a.params.$input.after(h);window.setTimeout(function(){h.fadeOut({complete:function(){h.remove()}})},1E3)}})},e=function(a){a.params={$label:a.$control.find('[data-type="directions-label"]'),$input:a.$control.find('[data-type="directions-input"]'),enabled:!1,autocomplete:null,startLatitude:0,startLongitude:0};d(a);return jQuery.extend(this,a)};e.prototype.getStatus=function(a){var b=null;a=a?new jQuery.fn.jplist.controls.GoogleMapDirectionsDTO(null):
new jQuery.fn.jplist.controls.GoogleMapDirectionsDTO(this.params.autocomplete.getPlace());return b=new jQuery.fn.jplist.StatusDTO(this.name,this.action,this.type,a,this.inStorage,this.inAnimation,this.isAnimateToTop,this.inDeepLinking)};e.prototype.setStatus=function(a,b){};jQuery.fn.jplist.itemControls.GoogleMapDirections=function(a){return new e(a)};jQuery.fn.jplist.itemControlTypes["google-map-directions"]={className:"GoogleMapDirections",options:{}}})();
